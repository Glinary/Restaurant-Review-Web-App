<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Profile</title>
    <link rel="stylesheet" href="viewprofile.css" />
    <script
      src="https://kit.fontawesome.com/78bb10c051.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="header">
      <div class="content-navbar">
        <div class="whenintaft-container">
          <h1 class="whenintaft">WhenInTaft</h1>
        </div>

        <div class="navbar-items-container">
          <div class="navbar-items">
            <span><h2 class="navbar">HOME</h2></span>
            <span><h2 class="navbar">RESTAURANTS</h2></span>
            <span><h2 class="navbar" id="viewprofile">VIEWPROFILE</h2></span>
          </div>
          <div class="line">
            <hr id="navbar-line" />
          </div>
        </div>
      </div>
      <div class="profile-navbar">
        <img src="assets/anonymous_picture.png" class="anonpic" />
      </div>
    </div>
    <hr id="header-divider" />

    <div class="search-section">
      <input type="text" class="search-bar" />
      <img src="assets/searchbutton.png" class="searchbutton" />
    </div>

    <div id="profilee">
      <div class="box">
        <div class="box-a">
          <a href="#profile" class="aboutme">About Me</a>
          <a href="#review" class="aboutme">Reviews</a>
          <a href="#" class="aboutme">Gallery</a>
        </div>
      </div>
      <div class="profile-section" id="profile">
        <div class="profile-pictures-section">
          <div class="profile-picture">
            <img src="assets/avatar.webp" />
          </div>

          <div class="smaller-profiles">
            <img src="assets/avatar.webp" />
            <img src="assets/avatar.webp" />
            <img src="assets/avatar.webp" />
          </div>
        </div>
        <div class="profile-description">
          <h1>Hermoine Granger</h1>
          <p>
            At the age of one, Harry's parents are killed by Lord Voldemort, who
            then attempts to kill him with the Killing Curse. Due to The Power
            of Love from his mother's self-sacrifice, however, he survives and
            rebounds the curse upon Voldemort, getting a lightning bolt-shaped
            scar as a souvenir. The series' resident Eccentric Mentor,
            Dumbledore, then arranges to have his Muggle aunt and uncle take him
            in or else.
          </p>
        </div>

        <div class="edit-profile-section">
          <h4>Edit Profile</h4>
          <img src="assets/book_icon.png" />
        </div>
      </div>
      <div class="box"></div>
    </div>

    <div class="reviews-section">
      <div class="label-and-navigator" id="review">
        <h3>User's Reviews</h3>
        <ul>
          <li>1</li>
          <li>2</li>
          <li>3</li>
          <li>4</li>
          <li>5</li>
          <li>>></li>
        </ul>
      </div>
      <div class="reviews-content-container">
        <div class="reviews-left-container">
          <div class="left">
            <div class="reviews-user-details">
              <img
                src="assets/anonymous_picture.png"
                class="reviews-profile-pic"
              />
            </div>
            <div class="further-details">
              <div class="name">
                <a class="firstname" href="#">Hermoine Granger</a>
              </div>
              <div class="others">
                <p class="review-count">9 Reviews</p>
                
              </div>
            </div>
            <div id="reaction">
              <div id="helpful">
                <i class="fa-solid fa-thumbs-up" style="color: #000000"></i>
              </div><span class="count" value="14">14</span>
              <div id="unhelpful">
                <i class="fa-solid fa-thumbs-down" style="color: #000000;"></i></i>
              </div><span class="count" value="1">1</span>
            </div>
          </div>
          <div class="overall-stars">
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <p>stars</p>
          </div>
          <div class="review">
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua.
            </p>
          </div>
        </div>

        <div class="reviews-pictures">
          <img src="assets/starbucks.jpg" class="review-image" />
          <img src="assets/starbucks.jpg" class="review-image" />
        </div>
        <div id="EditMenu">
          <div id="editBar">
            <div id="editBars"></div>
            <div id="editBars"></div>
            <div id="editBars"></div>
          </div>
          <div id="EditNav">
            <ul>
              <li><a href="#">Edit</a></li>
              <li><a href="#">Delete</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="reviews-content-container">
        <div class="reviews-left-container">
          <div class="left">
            <div class="reviews-user-details">
              <img
                src="assets/anonymous_picture.png"
                class="reviews-profile-pic"
              />
            </div>
            <div class="further-details">
              <div class="name">
                <a class="firstname" href="#">Hermoine Granger</a>
              </div>
              <div class="others">
                <p class="review-count">9 Reviews</p>
                
              </div>
            </div>
            <div id="reaction">
              <div id="helpful">
                <i class="fa-solid fa-thumbs-up" style="color: #000000"></i>
              </div><span class="count" value="14">14</span>
              <div id="unhelpful">
                <i class="fa-solid fa-thumbs-down" style="color: #000000;"></i></i>
              </div><span class="count" value="1">1</span>
            </div>
          </div>
          <div class="overall-stars">
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <div id="Ostar"><i class="fa-regular fa-star"></i></div>
            <p>stars</p>
          </div>
          <div class="review">
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua.
            </p>
          </div>
          <span id="editedIndc">Edited</span>
        </div>

        <div class="reviews-pictures">
          <img src="assets/starbucks.jpg" class="review-image" />
          <img src="assets/starbucks.jpg" class="review-image" />
        </div>
        <div id="EditMenu">
          <div id="editBar">
            <div id="editBars"></div>
            <div id="editBars"></div>
            <div id="editBars"></div>
          </div>
          <div id="EditNav">
            <ul>
              <li><a href="#">Edit</a></li>
              <li><a href="#">Delete</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    const reviews = document.querySelectorAll(".review");
    const times = document.querySelectorAll(".review").length;
    const editBar = document.querySelectorAll("#EditMenu");
    const reactionH = document.querySelectorAll("#helpful");
    const reactionU = document.querySelectorAll("#unhelpful");
    const reaction = document.querySelectorAll("#reaction");
    const body = document.getElementsByTagName("BODY")[0];
    let arrH = [];
    let arrU = [];
    let currLike = [];
    let currDLike = [];
    let flag = true;
    let flag2 = true;
    // either helpful or unhelpful is toggled
    console.log(reaction);

    // more/less event listener
    for (let i = 0; i < times; i = i + 1) {
      revs = reviews[i];
      // assign value of text shown here (change 80)
      revs.innerText = truncateText(revs, 80);
      revs.innerHTML += '<span id="more">&nbsp;see more</span>';
    }

    // https://stackoverflow.com/a/63162630
    function truncateText(selector, maxLength) {
      var element = selector;
      truncated = element.innerText;
      truncate = truncated;

      if (truncated.length > maxLength) {
        truncated = truncated.substr(0, maxLength) + "...";
      }
      console.log("trucated: ", truncated);
      console.log(element, "Successfully Truncated");
      return truncated;
    }

    //https://stackoverflow.com/a/62555388
    reviews.forEach((cell) =>
      cell.addEventListener("click", function () {
        if (flag == true) {
          cell.innerHTML = truncate;
          cell.innerHTML += '<span id="more">&nbsp;see less</span>';
          flag = false;
        } else if (flag == false) {
          cell.innerHTML = truncated;
          cell.innerHTML += '<span id="more">&nbsp;see more</span>';
          flag = true;
        }
      })
    );
    // more/less event listener end...
    
    // editBar div event listener (when clicked delete/edit shows)
    editBar.forEach((cell) =>
      cell.addEventListener("click", function () {
        if (flag2 == true) {
          console.log(cell);
          cld = cell.lastElementChild;
          console.log(cld);
          cld.style.display = "block";
          flag2 = false;
        } else if (flag2 == false) {
          console.log(cell);
          cld = cell.lastElementChild;
          console.log(cld);
          cld.style.display = "none";
          flag2 = true;
        }
      })
    );

    // click everywhere event listener
    //https://stackoverflow.com/a/33657471
    body.addEventListener(
      "click",
      function () {
        if (flag2 == false) {
          cld.style.display = "none";
          flag2 = true;
        }
      },
      false
    );
    // excludes editbar 
    editBar.forEach(
      (cell) =>
        cell.addEventListener("click", function (ev) {
          ev.stopPropagation(); //this is important! If removed, you'll get both alerts
        }),
      false
    );
    // excludes reaction div
    reactionH.forEach(
      (cell) =>
        cell.addEventListener("click", function (ev) {
          ev.stopPropagation(); //this is important! If removed, you'll get both alerts
        }),
      false
    );
    

    
    // console.log(reaction[1]);

    /*Initialize Reaction Button Data*/
    for (let i = 0; i < reactionH.length; i++){
      arrH.push(0);
      arrU.push(0);
      currLike.push(parseInt(reactionH[i].nextSibling.attributes[1].value));
      currDLike.push(parseInt(reactionU[i].nextSibling.attributes[1].value));

    }
    /**! CHECKER
    console.log(arrH);
    console.log(arrU);
    console.log(currLike);
    console.log(currDLike);
    */

    for(let j = 0; j < reactionH.length; j++) {
      reactionH[j].addEventListener("click", function(){
        if (arrU[j] == 0 && arrH[j] == 0){
            reactionH[j].innerHTML = "<i class=\"fa-solid fa-thumbs-up\" style=\"color: #087d6f;\"></i>"
            currLike[j] += 1 ;
            reactionH[j].nextSibling.innerText = currLike[j]
            arrH[j] = 1;
            console.log(arrH);
        } else if (arrU[j] == 0 && arrH[j] == 1){
            reactionH[j].innerHTML = "<i class=\"fa-solid fa-thumbs-up\" style=\"color: #000000\"></i>"
            currLike[j] -= 1 ;
            reactionH[j].nextSibling.innerText = currLike[j];
            arrH[j] = 0;
            console.log(arrH);
          } 
      })
    }

    for(let k = 0; k < reactionU.length; k++) {
      reactionU[k].addEventListener("click", function(){
          if (arrH[k] == 0 && arrU[k] == 0) {
            reactionU[k].innerHTML = "<i class=\"fa-solid fa-thumbs-down\" style=\"color: #087d6f;\"></i>"
            currDLike[k] += 1 ;
            reactionU[k].nextSibling.innerText = currDLike[k];
            arrU[k] = 1;
            console.log(arrH);
          } 
          else if (arrH[k] == 0 && arrU[k] == 1){
            reactionU[k].innerHTML = "<i class=\"fa-solid fa-thumbs-down\" style=\"color: #000000\"></i>"
            currDLike[k] -= 1 ;
            reactionU[k].nextSibling.innerText = currDLike[k];
            arrU[k] = 0;
            console.log(arrU);
          }
      })
    }
  </script>
  </script>
</html>

<!-- // add a for loop for event listeners on the nodelist
for (i = 0; i < editBar.length; i++) {
  editBar.item(i).addEventListener("click", function () {
    console.log(editBar[i]);
    child = editBar[i].lastElementChild;
    console.log(child);
  });
} -->
